<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ESP32 BLE Motor Control</title>
</head>
<body>
  <h2>Motor Speed Control (RPM)</h2>
  <label>Target RPM: <input type="number" id="rpmInput" value="150"></label>
  <button onclick="sendRPM()">Send RPM</button>
  <h3>Current RPM: <span id="currentRPM">---</span></h3>
  <button onclick="connectBLE()">Connect to ESP32</button>

  <script>
    let writeChar, notifyChar;

    const SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
    const CHARACTERISTIC_RX = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";
    const CHARACTERISTIC_TX = "6e400003-b5a3-f393-e0a9-e50e24dcca9e";

    async function connectBLE() {
      const device = await navigator.bluetooth.requestDevice({
        filters: [{ services: [SERVICE_UUID] }]
      });

      const server = await device.gatt.connect();
      const service = await server.getPrimaryService(SERVICE_UUID);

      writeChar = await service.getCharacteristic(CHARACTERISTIC_RX);
      notifyChar = await service.getCharacteristic(CHARACTERISTIC_TX);

      notifyChar.startNotifications();
      notifyChar.addEventListener('characteristicvaluechanged', event => {
        const value = new TextDecoder().decode(event.target.value);
        document.getElementById('currentRPM').innerText = value;
      });
    }

    function sendRPM() {
      const rpm = document.getElementById('rpmInput').value;
      if (writeChar) {
        const data = new TextEncoder().encode(rpm.toString());
        writeChar.writeValue(data);
      }
    }
  </script>
</body>
</html>
